<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Sistema BB</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
margin:0;
font-family:Arial;
background:#f4f4f4;
}

header{
background:#8B0000;
color:white;
padding:15px;
text-align:center;
font-size:22px;
font-weight:bold;
}

nav{
background:#5a0000;
display:flex;
flex-wrap:wrap;
}

nav button{
flex:1;
padding:12px;
border:none;
background:#5a0000;
color:white;
cursor:pointer;
font-weight:bold;
}

nav button:hover{
background:#8B0000;
}

.container{
padding:20px;
}

.card{
background:white;
padding:15px;
margin-bottom:15px;
border-radius:8px;
box-shadow:0 2px 5px rgba(0,0,0,0.1);
}

input,select{
width:100%;
padding:8px;
margin:5px 0;
}

button.acao{
background:#8B0000;
color:white;
border:none;
padding:10px;
cursor:pointer;
margin-top:5px;
width:100%;
}

button.acao:hover{
background:#5a0000;
}

table{
width:100%;
border-collapse:collapse;
}

th,td{
border:1px solid #ddd;
padding:8px;
text-align:center;
}

th{
background:#8B0000;
color:white;
}

@media(max-width:600px){
nav button{
flex:100%;
}
}
</style>
</head>

<body>

<header>Sistema BB</header>

<nav>
<button onclick="render('estoque')">ðŸ“¦ Estoque</button>
<button onclick="render('pedido')">ðŸ§¾ Pedido</button>
<button onclick="render('financeiro')">ðŸ“Š Financeiro</button>
</nav>

<div class="container" id="conteudo"></div>

<script>

const DB="COLE_AQUI_SUA_URL_FIREBASE";

function render(tela){

const c=document.getElementById("conteudo");

if(tela==="estoque"){
c.innerHTML=`
<div class="card">
<h2>Cadastro de Estoque</h2>
<input id="produto" placeholder="Produto">
<input id="quantidade" type="number" placeholder="Quantidade">
<input id="precoCusto" type="number" placeholder="PreÃ§o de Custo">
<input id="precoVenda" type="number" placeholder="PreÃ§o de Venda">
<button class="acao" onclick="salvarEstoque()">Salvar Produto</button>
</div>

<div class="card">
<h2>Lista de Produtos</h2>
<div id="listaEstoque"></div>
</div>
`;

carregarEstoque();
}

if(tela==="pedido"){
c.innerHTML=`
<div class="card">
<h2>Novo Pedido</h2>
<input id="numPedido" placeholder="NÃºmero do Pedido">
<input id="cliente" placeholder="Cliente">
<input id="produtoPedido" placeholder="Produto">
<input id="valorVenda" type="number" placeholder="Valor da Venda">
<button class="acao" onclick="salvarPedido()">Finalizar Pedido</button>
</div>
`;
}

if(tela==="financeiro"){
carregarFinanceiro();
}

}

async function salvarEstoque(){
const produto=document.getElementById("produto").value;
const quantidade=document.getElementById("quantidade").value;
const precoCusto=document.getElementById("precoCusto").value;
const precoVenda=document.getElementById("precoVenda").value;

await fetch(DB+"/estoque.json",{
method:"POST",
body:JSON.stringify({
produto,
quantidade,
precoCusto,
precoVenda
})
});

render('estoque');
}

async function carregarEstoque(){
const r=await fetch(DB+"/estoque.json");
const d=await r.json();

let html="<table><tr><th>Produto</th><th>Qtd</th><th>Custo</th><th>Venda</th></tr>";

if(d){
Object.values(d).forEach(p=>{
html+=`
<tr>
<td>${p.produto}</td>
<td>${p.quantidade}</td>
<td>R$ ${p.precoCusto}</td>
<td>R$ ${p.precoVenda}</td>
</tr>
`;
});
}

html+="</table>";
document.getElementById("listaEstoque").innerHTML=html;
}

async function salvarPedido(){

const num=document.getElementById("numPedido").value;
if(!num){alert("Pedido precisa ter nÃºmero");return;}

const cliente=document.getElementById("cliente").value;
const produto=document.getElementById("produtoPedido").value;
const valorVenda=parseFloat(document.getElementById("valorVenda").value);

let lucro=0;

const r=await fetch(DB+"/estoque.json");
const estoque=await r.json();

if(estoque){
for(const [id,item] of Object.entries(estoque)){
if(item.produto===produto){

lucro=valorVenda-parseFloat(item.precoCusto);

let novaQtd=parseInt(item.quantidade)-1;
if(novaQtd<0){alert("Estoque insuficiente");return;}

await fetch(DB+"/estoque/"+id+".json",{
method:"PUT",
body:JSON.stringify({
produto:item.produto,
quantidade:novaQtd,
precoCusto:item.precoCusto,
precoVenda:item.precoVenda
})
});
break;
}
}
}

await fetch(DB+"/pedidos.json",{
method:"POST",
body:JSON.stringify({
num,
cliente,
produto,
total:valorVenda,
lucro,
data:new Date().toLocaleDateString()
})
});

alert("Pedido finalizado!");
render('financeiro');
}

async function carregarFinanceiro(){

const r=await fetch(DB+"/pedidos.json");
const d=await r.json();

let faturamento=0;
let lucroTotal=0;
let labels=[];
let valores=[];
let linhas="";

if(d){
Object.values(d).forEach(p=>{
faturamento+=parseFloat(p.total||0);
lucroTotal+=parseFloat(p.lucro||0);

labels.push(p.data);
valores.push(p.total);

linhas+=`
<tr>
<td>${p.data}</td>
<td>${p.num}</td>
<td>${p.cliente}</td>
<td>R$ ${p.total}</td>
<td style="color:green;">R$ ${p.lucro}</td>
</tr>
`;
});
}

document.getElementById("conteudo").innerHTML=`
<div class="card">
<h2>Dashboard Financeiro</h2>
<h3>Faturamento Total: R$ ${faturamento.toFixed(2)}</h3>
<h3 style="color:green;">Lucro Total: R$ ${lucroTotal.toFixed(2)}</h3>
</div>

<div class="card">
<canvas id="grafico"></canvas>
</div>

<div class="card">
<table>
<tr>
<th>Data</th>
<th>Pedido</th>
<th>Cliente</th>
<th>Venda</th>
<th>Lucro</th>
</tr>
${linhas}
</table>
</div>
`;

new Chart(document.getElementById('grafico'),{
type:'bar',
data:{
labels:labels,
datasets:[{
label:'Faturamento',
data:valores,
backgroundColor:'#8B0000'
}]
}
});
}

render('estoque');

</script>

</body>
</html>
