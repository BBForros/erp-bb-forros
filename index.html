<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP BB Forros | Gest칚o Completa Administrativa</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root { --primary: #8b0000; --dark: #1a0000; --bg: #f8f9fa; --white: #ffffff; --text: #333; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', system-ui, sans-serif; }
        body { background: var(--bg); color: var(--text); min-height: 100vh; }

        /* Login Responsivo */
        .overlay { position: fixed; inset: 0; background: var(--dark); display: flex; align-items: center; justify-content: center; z-index: 9999; padding: 20px; }
        .login-box { background: var(--white); padding: 30px; border-radius: 15px; width: 100%; max-width: 400px; text-align: center; border-top: 8px solid var(--primary); box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .login-box img { width: 150px; margin-bottom: 20px; }

        /* Estrutura Principal */
        #app { display: none; flex-direction: column; height: 100vh; }
        .top-bar { height: 70px; background: var(--white); border-bottom: 1px solid #dee2e6; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; z-index: 100; position: sticky; top: 0; }
        .top-bar .brand { display: flex; align-items: center; gap: 10px; }
        .top-bar img { height: 45px; width: auto; }
        .top-bar b { color: var(--primary); font-size: 1.1rem; }

        .main-layout { display: flex; flex: 1; overflow: hidden; }

        /* Sidebar Responsiva */
        .sidebar { width: 250px; background: var(--dark); display: flex; flex-direction: column; transition: 0.3s; flex-shrink: 0; }
        .menu-links { flex: 1; padding: 15px; }
        .menu-links button { width: 100%; padding: 12px 15px; background: transparent; border: none; color: #adb5bd; text-align: left; cursor: pointer; border-radius: 8px; margin-bottom: 5px; font-weight: 600; display: flex; align-items: center; gap: 10px; transition: 0.2s; }
        .menu-links button:hover, .menu-links button.active { background: var(--primary); color: white; }
        .btn-sair { background: #000; color: white; padding: 15px; border: none; cursor: pointer; font-weight: bold; width: 100%; text-transform: uppercase; }

        /* 츼rea de Conte칰do */
        .content-area { flex: 1; padding: 25px; overflow-y: auto; }
        .container { max-width: 1100px; margin: 0 auto; }
        h1 { margin-bottom: 20px; font-size: 1.5rem; color: var(--dark); display: flex; align-items: center; gap: 10px; }

        /* Cards e Formul치rios */
        .card { background: var(--white); padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid #edf2f7; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .span-full { grid-column: 1 / -1; }
        
        label { display: block; font-size: 11px; font-weight: 700; color: #666; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 0.5px; }
        input, select, textarea { width: 100%; padding: 10px 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 14px; transition: 0.2s; background: #fff; }
        input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(139, 0, 0, 0.1); }
        textarea { height: 80px; resize: vertical; }

        .btn-save { background: var(--primary); color: white; padding: 14px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; font-size: 1rem; margin-top: 10px; box-shadow: 0 4px 6px rgba(139, 0, 0, 0.2); }
        .btn-save:hover { filter: brightness(1.2); }

        /* Tabelas */
        .table-res { overflow-x: auto; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th { background: #f8f9fa; padding: 12px; text-align: left; font-size: 12px; color: #666; text-transform: uppercase; border-bottom: 2px solid #dee2e2; }
        td { padding: 12px; border-bottom: 1px solid #eee; font-size: 14px; }
        .btn-pdf-tbl { background: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 4px; font-size: 11px; cursor: pointer; font-weight: bold; }

        /* Ajustes Mobile */
        @media (max-width: 768px) {
            .sidebar { width: 70px; }
            .sidebar button span { display: none; }
            .sidebar button { justify-content: center; padding: 15px 0; }
            .top-bar b { display: none; }
            .content-area { padding: 15px; }
        }
    </style>
</head>
<body>

    <div id="login-screen" class="overlay">
        <div class="login-box">
            <img src="LogoBB.png" alt="BB Forros" onerror="this.src='https://via.placeholder.com/150?text=BB+FORROS'">
            <h2 style="color:var(--primary); margin-bottom: 5px;">Acesso Restrito</h2>
            <p style="font-size: 13px; color: #666; margin-bottom: 20px;">Digite suas credenciais admin</p>
            <input type="text" id="user" placeholder="Usu치rio" style="margin-bottom: 10px;">
            <input type="password" id="pass" placeholder="Senha" style="margin-bottom: 15px;">
            <button onclick="entrar()" class="btn-save">ACESSAR SISTEMA</button>
        </div>
    </div>

    <div id="app">
        <header class="top-bar">
            <div class="brand">
                <img src="LogoBB.png" alt="Logo">
                <b>BB COM칄RCIO DE FORROS</b>
            </div>
            <div style="font-size: 12px; color: #666;">Painel: <strong>Administrador</strong></div>
        </header>

        <div class="main-layout">
            <aside class="sidebar">
                <nav class="menu-links">
                    <button onclick="render('fin')" id="btn-fin">游늵 <span>FINANCEIRO</span></button>
                    <button onclick="render('cli')" id="btn-cli">游논 <span>CLIENTES</span></button>
                    <button onclick="render('ped')" id="btn-ped">游 <span>VENDAS / PEDIDOS</span></button>
                    <button onclick="render('est')" id="btn-est">游닍 <span>ESTOQUE</span></button>
                </nav>
                <button onclick="location.reload()" class="btn-sair">Sair</button>
            </aside>

            <main class="content-area" id="view-container"></main>
        </div>
    </div>

    <script>
        const DB_URL = "https://erp-bb-forros-default-rtdb.firebaseio.com";

        function entrar() {
            if(document.getElementById('user').value === 'admin') {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app').style.display = 'flex';
                render('fin');
            } else { alert("Usu치rio inv치lido"); }
        }

        async function render(tela) {
            const area = document.getElementById('view-container');
            area.innerHTML = "<div class='container'><h2>Carregando dados...</h2></div>";
            
            // Marcar bot칚o ativo
            document.querySelectorAll('.menu-links button').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-'+tela).classList.add('active');

            if (tela === 'fin') {
                const r = await fetch(`${DB_URL}/pedidos.json`);
                const d = await r.json();
                const peds = d ? Object.values(d) : [];
                const total = peds.reduce((acc, p) => acc + parseFloat(p.total || 0), 0);
                area.innerHTML = `<div class="container">
                    <h1>游늵 Painel Financeiro</h1>
                    <div class="form-grid">
                        <div class="card"><label>Faturamento Bruto</label><h2 style="color:var(--primary)">R$ ${total.toLocaleString('pt-br',{minimumFractionDigits:2})}</h2></div>
                        <div class="card"><label>Vendas Realizadas</label><h2>${peds.length}</h2></div>
                    </div>
                </div>`;
            }

            if (tela === 'cli') {
                const r = await fetch(`${DB_URL}/clientes.json`);
                const d = await r.json();
                const clis = d ? Object.values(d) : [];
                area.innerHTML = `<div class="container">
                    <h1>游논 Cadastro de Clientes</h1>
                    <div class="card">
                        <div class="form-grid">
                            <div class="span-full"><label>Nome / Raz칚o Social</label><input id="cnome"></div>
                            <div><label>CNPJ / CPF</label><input id="cdoc"></div>
                            <div><label>RG / Insc. Est.</label><input id="crg"></div>
                            <div><label>Celular / WhatsApp</label><input id="ctel"></div>
                            <div><label>Contato</label><input id="ccont"></div>
                            <div class="span-full"><label>Endere칞o</label><input id="cend"></div>
                            <div><label>Bairro</label><input id="cbairro"></div>
                            <div><label>Cidade / Estado</label><input id="ccid"></div>
                            <div><label>Bolso</label><input id="cbolso"></div>
                            <div><label>Forma de Pagamento</label><input id="cpag"></div>
                            <div class="span-full"><label>Observa칞칫es</label><textarea id="cobs"></textarea></div>
                        </div>
                        <button class="btn-save" onclick="salvarCli()">CADASTRAR NOVO CLIENTE</button>
                    </div>
                    <div class="card">
                        <label>칔ltimos Clientes</label>
                        <div class="table-res">
                            <table><thead><tr><th>Nome</th><th>WhatsApp</th><th>Cidade</th></tr></thead>
                            <tbody>${clis.reverse().slice(0,10).map(c => `<tr><td>${c.nome}</td><td>${c.tel}</td><td>${c.cid || '-'}</td></tr>`).join('')}</tbody></table>
                        </div>
                    </div>
                </div>`;
            }

            if (tela === 'ped') {
                const r = await fetch(`${DB_URL}/pedidos.json`);
                const d = await r.json();
                const peds = d ? Object.values(d) : [];
                area.innerHTML = `<div class="container">
                    <h1>游 Nova Venda / Pedido</h1>
                    <div class="card">
                        <div class="form-grid">
                            <div><label>N췈 Pedido</label><input id="pnum" placeholder="0001"></div>
                            <div><label>Data</label><input id="pdata" type="date" value="${new Date().toISOString().split('T')[0]}"></div>
                            <div class="span-full"><label>Cliente</label><input id="pcli"></div>
                            <div class="span-full"><label>Descri칞칚o do Material</label><input id="pmat"></div>
                            <div><label

